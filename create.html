<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create</title>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
  </head>
  <body>
    <h1>Create New Company</h1>
    <form
      action="createProcess.php"
      method="post"
      class="container-md"
      autocomplete="off"
    >
      <div class="form-floating mb-3">
        <input
          class="form-control"
          type="text"
          id="name"
          name="name"
          minlength="3"
          required
          onkeyup="handleInput(this)"
          placeholder="Company Name"
        />
        <label for="name">Company Name:</label>
        <span id="message" class="valid-feedback">That's is available</span>
        <span id="err" class="invalid-feedback"></span>
      </div>
      <div class="form-floating mb-3">
        <input
          class="form-control"
          type="number"
          name="year"
          id="year"
          required
          placeholder="2023"
        />
        <label for="year">Year Started</label>
      </div>
      <div class="form-floating mb-3">
        <input
          class="form-control"
          type="text"
          id="tagline"
          name="tagline"
          placeholder="Just do it."
          required
        />
        <label for="tagline">tagline</label>
      </div>
      <div class="form-floating mb-3">
        <input
          class="form-control"
          id="branches"
          type="number"
          name="branches"
          placeholder="10"
          required
        />
        <label for="branches">branches</label>
      </div>
      <div class="form-floating mb-3">
        <input
          class="form-control"
          type="text"
          id="headquarter"
          name="headquarter"
          placeholder="Makati City"
          required
        />
        <label for="headquarter">headquarter</label>
      </div>
      <button
        class="btn btn-outline-secondary"
        id="backBtn"
        onclick="handleBackClick()"
        type="button"
      >
        Back
      </button>

      <input
        id="submit"
        type="submit"
        value="Save New Company"
        class="btn btn-primary"
      />
    </form>
  </body>

  <script>
    function handleBackClick() {
      window.location.href = "/";
    }

    var submitBtn = document.getElementById("submit");
    var companyNameErrorMessage = document.getElementById("err");

    function handleInput(inputElement) {
      var inputValue = inputElement.value;

      // disbales the submit button if length is less than 3 or text is only spaces.
      if (inputValue.length < 3 || inputValue.trim().length === 0) {
        inputElement.classList.add("is-invalid");
        inputElement.classList.remove("is-valid");
        companyNameErrorMessage.innerHTML = "Company name is too short.";

        submitBtn.disabled = true;
      } else {
        var http = new XMLHttpRequest();

        http.onreadystatechange = function () {
          if (http.readyState === 4 && http.status === 200) {
            var responseText = http.responseText;
            // checks the response from the server. Disables the submit button if 'Is in use' is the response.
            if (responseText == " in use.") {
              companyNameErrorMessage.textContent = "Is in use!";
              inputElement.classList.add("is-invalid");
              inputElement.classList.remove("is-valid");

              submitBtn.disabled = true;
            } else if (responseText == " is available.") {
              inputElement.classList.add("is-valid");
              inputElement.classList.remove("is-invalid");

              submitBtn.disabled = false;
            }
          }
        };
        http.open("GET", "checkID.php?q=" + inputValue, true);
        http.send();
      }
    }
  </script>
</html>
