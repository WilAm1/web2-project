<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- bootstrap  -->
    <script src="/assets/bootstrap/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css" />
    <!--  JQuery and JQueryUI  -->
    <script src="assets/jquery-3.6.4.min.js"></script>
    <script src="assets/jquery-ui/jquery-ui.min.js"></script>
    <!-- Own JS  -->
    <script src="assets/js/indexPage.js"></script>
    <!-- Own CSS -->
    <link rel="stylesheet" href="assets/styles.css" />
    <title>Create</title>
  </head>
  <body>
    <nav>
      <div class="menus mt-5 d-flex justify-content-center nav-box">
        <a class="nav-link active m-2 text-decoration-none" href="index.php"
          >Home</a
        >
        <a class="nav-link m-2 text-decoration-none" href="create.html">Add</a>
        <a class="nav-link m-2 text-decoration-none" href="update.php">Edit</a>
        <a class="nav-link m-2 text-decoration-none" href="delete.php"
          >Delete</a
        >

        <form
          action="./searchProcess.php"
          method="GET"
          autocomplete="off"
          class="search-form"
        >
          <div class="search-box">
            <label for="search" class="col-form-label">Search:</label>
            <div class="input-group m-2">
              <input
                class="form-control"
                placeholder="Company"
                type="search"
                id="search"
                name="q"
              />
              <div id="autocomplete-list"></div>
            </div>
          </div>
        </form>
      </div>
    </nav>

    <div class="container text-center">
      <h1 class="text-primary">Create New Company</h1>
      <form action="createProcess.php" method="post" autocomplete="off">
        <div class="formContainer">
          <!-- company name -->
          <div class="input-group mb-5 w-75 mx-auto">
            <div class="form-text">
              Company name must have 3 minimum characters
            </div>
            <label class="input-group-text fw-bold" for="companyName"
              >Name:</label
            >
            <input
              class="form-control"
              id="companyName"
              type="text"
              name="name"
              minlength="3"
              required
              placeholder="ex: BulSU Company"
              onkeyup="handleInput(this)"
            />
            <!-- 'this' refers to the  company name input text -->
            <span id="message" class="valid-feedback"
              >That company is available!</span
            >
            <span id="err" class="invalid-feedback"></span>
          </div>

          <!-- year started -->
          <div class="input-group mb-5 w-75 mx-auto">
            <label class="input-group-text fw-bold" for="yearStarted"
              >Year Started:
            </label>
            <input
              class="form-control"
              id="yearStarted"
              type="number"
              name="year"
              placeholder="ex: 2025"
              required
            />
          </div>

          <!-- tagline -->
          <div class="input-group mb-5 w-75 mx-auto">
            <label class="input-group-text fw-bold" for="tagLine"
              >Tagline:</label
            >
            <input
              class="form-control"
              id="tagLine"
              type="text"
              name="tagline"
              placeholder="ex: We stay connected even offline"
              required
            />
          </div>

          <!-- total branch -->
          <div class="input-group mb-5 w-75 mx-auto">
            <label class="input-group-text fw-bold" for="branches"
              >Total Branch:</label
            >
            <input
              class="form-control"
              id="branches"
              type="number"
              name="branches"
              placeholder="ex: 106"
              required
            />
          </div>

          <!-- total headquarter -->
          <div class="input-group mb-5 w-75 mx-auto">
            <label class="input-group-text fw-bold" for="headquarter"
              >Headquarter:</label
            >
            <input
              class="form-control"
              id="headquarter"
              type="text"
              name="headquarter"
              placeholder="ex: Makati"
              required
            />
          </div>

          <a class="btn btn-outline-primary" href="index.php">Back</a>
          <input
            class="btn btn-primary"
            id="submit"
            type="submit"
            value="Save New Company"
          />
        </div>
      </form>
    </div>
  </body>

  <script>
    var submitBtn = document.getElementById("submit");
    var companyNameErrorMessage = document.getElementById("err");

    function handleInput(inputElement) {
      //inputElement is the company name input text
      var inputValue = inputElement.value;

      // disbales the submit button if length is less than 3 or text is only spaces.
      if (inputValue.length < 3 || inputValue.trim().length == 0) {
        inputElement.classList.add("is-invalid");
        inputElement.classList.remove("is-valid");
        submitBtn.classList.add("btn-secondary");
        submitBtn.classList.remove("btn-primary");

        companyNameErrorMessage.innerHTML =
          "Company name must not be empty or too short.";
        submitBtn.disabled = true;
      } else {
        var http = new XMLHttpRequest();

        http.onreadystatechange = function () {
          // checks the response from the server. Disables the submit button if 'false' is the response.
          if (http.readyState === 4 && http.status === 200) {
            var responseText = http.responseText;
            if (responseText == "false") {
              companyNameErrorMessage.textContent =
                "That company was already been created.";
              inputElement.classList.add("is-invalid");
              inputElement.classList.remove("is-valid");
              submitBtn.classList.add("btn-secondary");
              submitBtn.classList.remove("btn-primary");

              submitBtn.disabled = true;
            } else if (responseText == "true") {
              companyNameErrorMessage.textContent =
                "That company is available!";

              inputElement.classList.add("is-valid");
              inputElement.classList.remove("is-invalid");
              submitBtn.classList.remove("btn-secondary");
              submitBtn.classList.add("btn-primary");

              submitBtn.disabled = false;
            }
          }
        };
        http.open("GET", "checkIdProcess.php?q=" + inputValue, true);
        http.send();
      }
    }
  </script>
</html>
